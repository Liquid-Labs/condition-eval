{"version":3,"file":"index.js","sources":["../node_modules/@babel/runtime/helpers/classCallCheck.js","../node_modules/@babel/runtime/helpers/createClass.js","../node_modules/@babel/runtime/helpers/defineProperty.js","../js/Evaluator.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","const paramRe = new RegExp('(^|[ (!&=|+-])([A-Z_][A-Z0-9_]+)', 'g')\nconst safeEvalRe = new RegExp('^ *(\\\\(|[0-9]+|false|true|!)(( |\\\\()+([0-9]+|true|false|!|&&|[|]{2}|==|!=|\\\\+|-|%|\\\\*)( |\\\\)*))* *$')\n\n/**\n* A safe-ish (TODO: developed based on a Stackexchange post; find and link?) boolean expression evaluator.\n*/\nconst Evaluator = class {\n  // declare recognized internal parameters\n  parameters\n  zeroRes\n\n  /**\n  * Recogrizes 'parameters' and 'zeroRes' field.\n  *\n  * 'parameters' maps strings to values. E.g.: parameters `{ \"IS_CONTRACTOR\": 1 }` would cause the condition\n  * `IS_CONTRACTOR` to evaluate true.\n  *\n  * 'zeroRes' is an array of RegExps used to match against a condition string *after* resolving all the parameters. If a\n  *    match is made, then that value is set to zero. I.e., `zeroRes` determines which parameters are default zero.\n  */\n  constructor(settings) {\n    Object.assign(this, settings)\n\n    this.parameters = this.parameters || {}\n    this.zeroRes = this.zeroRes || []\n  }\n\n  evalTruth(origExpression) {\n    if (typeof origExpression !== 'string') {\n      throw new Error(`Expression must be a string. Got: '${expression}'.`)\n    }\n\n    var expression = origExpression // save original expression in case we need to reflect to user on error\n\n    // replace all the parameters in the expression\n    const results = expression.matchAll(paramRe)\n    for (var result of results) {\n      const param = result[2]\n      let val = this.parameters[param] // look on the parameter object\n      if (val === undefined) { // if not defined, look on process.env\n        val = process.env[param]\n      }\n      if (val === undefined) {\n        if (this.zeroRes.some((re) => param.match(re))) {\n          val = 0\n        }\n        else {\n          throw new Error(`Condition parameter '${param}' is not defined. Update settings and/or check expression.`)\n        }\n      }\n\n      // 'replaceAll' not supported on node (TODO: add Babel tform); though 'replace' does replace all *if* first arg is\n      // RE... so... maybe not necessary?)\n      expression = expression.replace(new RegExp(`(^|[^A-Z0-9_])${param}([^A-Z0-9_]|$)`, 'g'), `$1 ${val} $2`)\n    }\n\n    // check that everything is save\n    if (!expression.match(safeEvalRe)) {\n      throw new Error(`Invalid expression does not fully resolve or has unsafe code: ${origExpression} => ${expression}`)\n    }\n    // else, let's eval it\n    return Function(`\"use strict\";return (${expression}) ? true : false`)() // eslint-disable-line no-new-func\n  }\n}\n\nexport { Evaluator }\n"],"names":["paramRe","RegExp","safeEvalRe","Evaluator","settings","Object","assign","parameters","zeroRes","origExpression","Error","expression","results","matchAll","result","param","val","undefined","process","env","some","re","match","replace","Function"],"mappings":"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"}